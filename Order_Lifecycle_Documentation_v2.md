# Order & Order Item Lifecycle Documentation

## Supply Chain & SSR Solution

**Solution Name:** SupplyChainSSR  
**Version:** 1.1.0.3

---

## Table of Contents

1. [Overview](#overview)
2. [Order Item Lifecycle](#order-item-lifecycle)
3. [PO (Purchase Order) Lifecycle](#po-purchase-order-lifecycle)
4. [Detailed Process Flow](#detailed-process-flow)
5. [Status Definitions](#status-definitions)
6. [Actions by Stage](#actions-by-stage)

---

## Overview

### Key Actors

| Actor | Role |
|-------|------|
| Azure Function | Auto-generates system forecasted orders |
| User (Planner) | Edits forecasts, creates orders, manages allocation & shipping |
| Regulatory Office | Approves labels for each order |
| CFO | Approves the complete PO |
| UP (Manufacturer) | External - confirms when to start allocation |

### Key Entities

| Entity | Purpose |
|--------|---------|
| Order Item | Individual SKU order line (forecast or planned) |
| PO (Purchase Order) | Groups order items for a country |
| Label | Regulatory label assigned to order items |
| Shipment | Groups allocated items for delivery |

---

## Order Item Lifecycle

### Lifecycle Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           ORDER ITEM LIFECYCLE                              │
└─────────────────────────────────────────────────────────────────────────────┘

     ┌──────────────┐
     │ FORECASTED   │ ◄─── Azure Function auto-generates
     └──────┬───────┘
            │ User edits / User creates new
            ▼
     ┌──────────────┐
     │   PLANNED    │ ◄─── User sets status or creates new order
     └──────┬───────┘
            │ Confirm & Link to PO + Select Label
            ▼
     ┌──────────────┐
     │   PENDING    │ ◄─── Awaiting Regulatory approval
     │  REGULATORY  │
     └──────┬───────┘
            │ Regulatory approves label
            ▼
     ┌──────────────┐
     │  REGULATORY  │ ◄─── Label approved, awaiting PO approval
     │   APPROVED   │
     └──────┬───────┘
            │ (Part of PO approval flow - see PO Lifecycle)
            │ CFO approves PO → User confirms to UP
            ▼
     ┌──────────────┐
     │  BACK ORDER  │ ◄─── Confirmed to UP, waiting for allocation signal
     └──────┬───────┘
            │ UP signals to allocate (external)
            │ User allocates (full or partial)
            │
            ├─────────────────────────────────────┐
            │ Full Amount                         │ Partial Amount
            ▼                                     ▼
     ┌──────────────┐                     ┌──────────────────────┐
     │  ALLOCATED   │                     │ Split into:          │
     │  TO MARKET   │                     │ • Allocated portion  │
     └──────┬───────┘                     │ • Remaining portion  │
            │                             └──────────┬───────────┘
            │                                        │
            │                     ┌──────────────────┼──────────────────┐
            │                     ▼                  ▼                  ▼
            │              ┌───────────┐     ┌────────────┐    ┌────────────┐
            │              │ ALLOCATED │     │ BACK ORDER │    │  DELETED   │
            │              │ TO MARKET │     │ (remaining)│    │ (remaining)│
            │              └─────┬─────┘     │ Push date  │    └────────────┘
            │                    │           └────────────┘
            │◄───────────────────┘
            │
            │ Initiate shipping (full or partial)
            ▼
     ┌──────────────┐
     │  SHIPPED TO  │ ◄─── Added to shipment
     │    MARKET    │
     └──────┬───────┘
            │ User marks arrival
            ▼
     ┌──────────────┐
     │  ARRIVED TO  │ ◄─── Final status
     │    MARKET    │
     └──────────────┘
```

### Order Item Statuses

| Status | Code | Description |
|--------|------|-------------|
| Forecasted | 1 | System-generated by Azure Function |
| Planned | 2 | User confirmed/created order |
| Pending Regulatory | 3 | Awaiting label approval |
| Regulatory Approved | 4 | Label approved by Regulatory |
| Back Order | 5 | Confirmed to UP, awaiting allocation |
| Allocated to Market | 6 | Stock allocated for delivery |
| Shipped to Market | 7 | In transit to market |
| Arrived to Market | 8 | Delivered to market |
| Deleted | 9 | Cancelled/removed |

---

## PO (Purchase Order) Lifecycle

### Lifecycle Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              PO LIFECYCLE                                   │
└─────────────────────────────────────────────────────────────────────────────┘

     ┌──────────────┐
     │    DRAFT     │ ◄─── Created when user links order items
     └──────┬───────┘
            │ All linked order items have Regulatory Approved status
            ▼
     ┌──────────────┐
     │   PENDING    │ ◄─── User requests CFO approval
     │ CFO APPROVAL │
     └──────┬───────┘
            │ CFO approves
            ▼
     ┌──────────────┐
     │ CFO APPROVED │
     └──────┬───────┘
            │ User confirms to UP (manufacturer)
            ▼
     ┌──────────────┐
     │ CONFIRMED    │ ◄─── All order items become "Back Order"
     │   TO UP      │
     └──────┬───────┘
            │ Allocation & Shipping progresses
            ▼
     ┌──────────────┐
     │  COMPLETED   │ ◄─── All order items arrived to market
     └──────────────┘
```

### PO Statuses

| Status | Code | Description |
|--------|------|-------------|
| Draft | 1 | Order items being linked |
| Pending CFO Approval | 2 | Awaiting CFO sign-off |
| CFO Approved | 3 | CFO has approved |
| Confirmed to UP | 4 | Sent to manufacturer |
| Completed | 5 | All items delivered |

---

## Detailed Process Flow

### Step 1: Forecast Generation

**Actor:** Azure Function  
**Trigger:** Automated/Scheduled

```
┌─────────────────────────────────────────────────────────────────┐
│                    FORECAST GENERATION                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Azure Function runs forecast calculation                       │
│                    │                                            │
│                    ▼                                            │
│  Creates Order Items with:                                      │
│  • Status: FORECASTED                                           │
│  • SKU (from forecast model)                                    │
│  • Country                                                      │
│  • Quantity                                                     │
│  • Month/Year                                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Actions Available:** None (system-generated)

---

### Step 2: Planning

**Actor:** User (Planner)  
**Screen:** Forecast Management

```
┌─────────────────────────────────────────────────────────────────┐
│                       PLANNING                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Option A: Edit Forecasted Order                                │
│  ┌─────────────────────────────────────┐                       │
│  │ • Adjust quantity                   │                       │
│  │ • Modify dates                      │                       │
│  │ • Set status → PLANNED              │                       │
│  └─────────────────────────────────────┘                       │
│                                                                 │
│  Option B: Create New Order                                     │
│  ┌─────────────────────────────────────┐                       │
│  │ • Select SKU                        │                       │
│  │ • Select Country                    │                       │
│  │ • Enter Quantity                    │                       │
│  │ • Set Month/Year                    │                       │
│  │ • Status automatically → PLANNED    │                       │
│  └─────────────────────────────────────┘                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Actions Available:**

| Action | Description |
|--------|-------------|
| Edit Quantity | Modify forecasted quantity |
| Edit Date | Change delivery month/year |
| Set as Planned | Confirm forecast as actual order |
| Create New | Add new order item manually |
| Delete | Remove forecasted order |

---

### Step 3: Confirm & Link to PO

**Actor:** User (Planner)  
**Screen:** Order Management

```
┌─────────────────────────────────────────────────────────────────┐
│                  CONFIRM & LINK TO PO                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Select Planned Order Items                                     │
│                    │                                            │
│                    ▼                                            │
│  ┌─────────────────────────────────────┐                       │
│  │ Choose:                             │                       │
│  │ ○ Link to NEW PO                    │                       │
│  │ ○ Link to EXISTING PO               │                       │
│  └─────────────────────────────────────┘                       │
│                    │                                            │
│                    ▼                                            │
│  ┌─────────────────────────────────────┐                       │
│  │ SELECT LABEL (Required)             │                       │
│  │ ┌─────────────────────────────────┐ │                       │
│  │ │ Label dropdown                  │ │                       │
│  │ │ (from new_labels table)         │ │                       │
│  │ └─────────────────────────────────┘ │                       │
│  └─────────────────────────────────────┘                       │
│                    │                                            │
│                    ▼                                            │
│  [Confirm] → Status changes to PENDING REGULATORY               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Actions Available:**

| Action | Description |
|--------|-------------|
| Select Order Items | Choose which planned items to confirm |
| Link to New PO | Create new Purchase Order |
| Link to Existing PO | Add to existing Purchase Order |
| Select Label | Assign regulatory label (required) |
| Confirm | Submit for regulatory approval |

---

### Step 4: Regulatory Approval

**Actor:** Regulatory Office  
**Screen:** Approval screens

```
┌─────────────────────────────────────────────────────────────────┐
│                  REGULATORY APPROVAL                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Regulatory Office reviews each order item's label              │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Order Item: N1-400 | Country: KSA | Label: Label-A      │   │
│  │                                                         │   │
│  │  [Approve Label]    [Reject Label]                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  On Approve → Status: REGULATORY APPROVED                       │
│  On Reject  → Status: PLANNED (user must resubmit)             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Actions Available:**

| Action | Description |
|--------|-------------|
| View Order Item | Review label and details |
| Approve Label | Approve the label for this order |
| Reject Label | Reject with reason |

---

### Step 5: PO Approval Request

**Actor:** User (Planner)  
**Prerequisite:** All order items in PO have status "Regulatory Approved"

```
┌─────────────────────────────────────────────────────────────────┐
│                   PO APPROVAL REQUEST                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  PO: PO-2025-001                                                │
│  Country: KSA                                                   │
│  Total Items: 5                                                 │
│  All Items Regulatory Approved: ✓                               │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Order Items:                                            │   │
│  │ ├─ N1-400 | 500 cartons | Regulatory Approved ✓         │   │
│  │ ├─ N1-800 | 300 cartons | Regulatory Approved ✓         │   │
│  │ ├─ N2-400 | 400 cartons | Regulatory Approved ✓         │   │
│  │ ├─ N2-800 | 250 cartons | Regulatory Approved ✓         │   │
│  │ └─ AC-400 | 150 cartons | Regulatory Approved ✓         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [Request CFO Approval] → PO Status: PENDING CFO APPROVAL       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Actions Available:**

| Action | Description |
|--------|-------------|
| View PO | Review all order items in PO |
| Request CFO Approval | Submit PO for CFO sign-off |

---

### Step 6: CFO Approval

**Actor:** CFO  
**Screen:** Approval screens

```
┌─────────────────────────────────────────────────────────────────┐
│                      CFO APPROVAL                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  PO: PO-2025-001                                                │
│  Country: KSA                                                   │
│  Total Value: $125,000                                          │
│  Items: 5                                                       │
│                                                                 │
│  ┌─────────────────────────────────────┐                       │
│  │                                     │                       │
│  │  [Approve PO]    [Reject PO]        │                       │
│  │                                     │                       │
│  └─────────────────────────────────────┘                       │
│                                                                 │
│  On Approve → PO Status: CFO APPROVED                           │
│  On Reject  → PO Status: DRAFT (user must resubmit)            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Actions Available:**

| Action | Description |
|--------|-------------|
| View PO Details | Review complete PO |
| Approve PO | Approve the purchase order |
| Reject PO | Reject with reason |

---

### Step 7: Confirm to UP (Manufacturer)

**Actor:** User (Planner)  
**Prerequisite:** PO has status "CFO Approved"

```
┌─────────────────────────────────────────────────────────────────┐
│                    CONFIRM TO UP                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  PO: PO-2025-001                                                │
│  Status: CFO Approved ✓                                         │
│                                                                 │
│  [Confirm to UP]                                                │
│         │                                                       │
│         ▼                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ System Actions:                                         │   │
│  │ • PO Status → CONFIRMED TO UP                           │   │
│  │ • ALL Order Items Status → BACK ORDER                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  Now waiting for UP (manufacturer) to signal                    │
│  when to start allocation (external communication)              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Actions Available:**

| Action | Description |
|--------|-------------|
| Confirm to UP | Send order to manufacturer |

**Result:** All order items in PO change to **BACK ORDER** status

---

### Step 8: Allocation

**Actor:** User (Planner)  
**Trigger:** UP (manufacturer) signals to allocate (external to system)  
**Screen:** Allocation Management

```
┌─────────────────────────────────────────────────────────────────┐
│                      ALLOCATION                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Order Item: N1-400 | Qty: 500 cartons | Status: BACK ORDER     │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Allocate Quantity: [________]                           │   │
│  │                                                         │   │
│  │ ○ Full Amount (500)                                     │   │
│  │ ○ Partial Amount                                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ═══════════════════════════════════════════════════════════   │
│                                                                 │
│  IF PARTIAL ALLOCATION:                                         │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Allocated: 300 cartons → ALLOCATED TO MARKET            │   │
│  │                                                         │   │
│  │ Remaining: 200 cartons                                  │   │
│  │ ┌─────────────────────────────────────────────────────┐ │   │
│  │ │ What to do with remaining?                         │ │   │
│  │ │                                                     │ │   │
│  │ │ ○ Push Delivery Date → Stays as BACK ORDER         │ │   │
│  │ │   New Date: [__/__/____]                           │ │   │
│  │ │                                                     │ │   │
│  │ │ ○ Delete Remaining → Status: DELETED               │ │   │
│  │ └─────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [Confirm Allocation]                                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Actions Available:**

| Action | Description |
|--------|-------------|
| Allocate Full | Allocate entire quantity |
| Allocate Partial | Allocate portion of quantity |
| Push Delivery Date | Reschedule remaining to later date |
| Delete Remaining | Cancel remaining quantity |
| Confirm Allocation | Complete allocation |

**Result:**
- Allocated portion → **ALLOCATED TO MARKET**
- Remaining (if pushed) → **BACK ORDER** (new delivery date, linked to original PO)
- Remaining (if deleted) → **DELETED**

---

### Step 9: Shipping

**Actor:** User (Planner)  
**Screen:** Shipping Management

```
┌─────────────────────────────────────────────────────────────────┐
│                       SHIPPING                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Order Items with Status: ALLOCATED TO MARKET                   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Select items to ship:                                   │   │
│  │ ☑ N1-400 | 300 cartons | Allocated to Market           │   │
│  │ ☑ N1-800 | 300 cartons | Allocated to Market           │   │
│  │ ☐ N2-400 | 400 cartons | Allocated to Market           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Choose:                                                 │   │
│  │ ○ Create NEW Shipment                                   │   │
│  │ ○ Add to EXISTING Shipment                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  If NEW Shipment:                                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Shipment Number: [Auto-generated]                       │   │
│  │ Delivery Date: [__/__/____]                             │   │
│  │ Destination: [Country Dropdown]                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [Initiate Shipping]                                            │
│         │                                                       │
│         ▼                                                       │
│  Selected items → Status: SHIPPED TO MARKET                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Actions Available:**

| Action | Description |
|--------|-------------|
| Select Order Items | Choose allocated items to ship |
| Create New Shipment | Create new shipment record |
| Add to Existing Shipment | Add to open shipment |
| Initiate Shipping | Complete shipping action |

**Result:** Selected items → **SHIPPED TO MARKET**

---

### Step 10: Arrival Confirmation

**Actor:** User (Planner)  
**Screen:** Shipping Management

```
┌─────────────────────────────────────────────────────────────────┐
│                   ARRIVAL CONFIRMATION                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Shipment: SHP-2025-001                                         │
│  Destination: KSA                                               │
│  Status: In Transit                                             │
│                                                                 │
│  Order Items:                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ N1-400 | 300 cartons | Shipped to Market                │   │
│  │ N1-800 | 300 cartons | Shipped to Market                │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [Mark as Arrived to Market]                                    │
│         │                                                       │
│         ▼                                                       │
│  All items → Status: ARRIVED TO MARKET                          │
│  Shipment → Status: COMPLETED                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Actions Available:**

| Action | Description |
|--------|-------------|
| Mark as Arrived | Confirm delivery to market |

**Result:** Items → **ARRIVED TO MARKET** (Final Status)

---

## Status Definitions

### Order Item Statuses

| Status | Description | Next Actions |
|--------|-------------|--------------|
| **Forecasted** | Auto-generated by Azure Function | Edit, Plan, Delete |
| **Planned** | User confirmed or created | Confirm & Link to PO |
| **Pending Regulatory** | Awaiting label approval | (Wait for Regulatory) |
| **Regulatory Approved** | Label approved | (Wait for PO approval) |
| **Back Order** | Confirmed to UP, awaiting allocation | Allocate |
| **Allocated to Market** | Stock allocated | Ship |
| **Shipped to Market** | In transit | Mark Arrived |
| **Arrived to Market** | Delivered (Final) | None |
| **Deleted** | Cancelled | None |

### PO Statuses

| Status | Description | Next Actions |
|--------|-------------|--------------|
| **Draft** | Order items being linked | Add items |
| **Pending CFO Approval** | Awaiting CFO | (Wait for CFO) |
| **CFO Approved** | CFO approved | Confirm to UP |
| **Confirmed to UP** | Sent to manufacturer | (Allocation begins) |
| **Completed** | All items delivered | None |

---

## Actions by Stage

### Complete Actions Matrix - Order Item

| Status | Edit | Delete | Link to PO | Select Label | Allocate (Full) | Allocate (Partial) | Push Date | Ship | Mark Arrived |
|--------|:----:|:------:|:----------:|:------------:|:---------------:|:------------------:|:---------:|:----:|:------------:|
| Forecasted | ✓ | ✓ | | | | | | | |
| Planned | ✓ | ✓ | ✓ | ✓ | | | | | |
| Pending Regulatory | | | | | | | | | |
| Regulatory Approved | | | | | | | | | |
| Back Order | | | | | ✓ | ✓ | ✓ | | |
| Allocated to Market | | | | | | | | ✓ | |
| Shipped to Market | | | | | | | | | ✓ |
| Arrived to Market | | | | | | | | | |

### Complete Actions Matrix - PO

| Status | Add Items | Remove Items | Request CFO Approval | Confirm to UP |
|--------|:---------:|:------------:|:--------------------:|:-------------:|
| Draft | ✓ | ✓ | ✓* | |
| Pending CFO Approval | | | | |
| CFO Approved | | | | ✓ |
| Confirmed to UP | | | | |
| Completed | | | | |

*Only when all items are Regulatory Approved

---

## Flow Summary Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        COMPLETE PROCESS FLOW                                │
└─────────────────────────────────────────────────────────────────────────────┘

AZURE FUNCTION                     USER                           APPROVERS
      │                              │                                │
      │ Generate Forecasts           │                                │
      ▼                              │                                │
┌──────────┐                         │                                │
│FORECASTED│─────────────────────────▶ Edit/Create                    │
└──────────┘                         │                                │
                                     ▼                                │
                              ┌──────────┐                            │
                              │ PLANNED  │                            │
                              └────┬─────┘                            │
                                   │ Confirm + Link to PO             │
                                   │ + Select Label                   │
                                   ▼                                  │
                              ┌──────────────┐                        │
                              │   PENDING    │────────────────────────▶ REGULATORY
                              │  REGULATORY  │                        │ Approves
                              └──────────────┘                        │ Label
                                   ▲                                  │
                                   │◄─────────────────────────────────┘
                                   ▼
                              ┌──────────────┐
                              │  REGULATORY  │
                              │   APPROVED   │
                              └──────┬───────┘
                                     │ Request PO Approval
                                     │ (all items approved)
                                     ▼
                              ┌──────────────┐                        │
                              │   PENDING    │────────────────────────▶ CFO
                              │ CFO APPROVAL │                        │ Approves
                              └──────────────┘                        │ PO
                                   ▲                                  │
                                   │◄─────────────────────────────────┘
                                   ▼
                              ┌──────────────┐
                              │ CFO APPROVED │
                              └──────┬───────┘
                                     │ Confirm to UP
                                     ▼
                              ┌──────────────┐
                              │  BACK ORDER  │◄──── All order items
                              └──────┬───────┘
                                     │
           ┌─────────────────────────┴─────────────────────────┐
           │                                                   │
           │ (External: UP signals to allocate)                │
           │                                                   │
           ▼                                                   ▼
    ┌──────────────┐                                   ┌──────────────┐
    │  ALLOCATED   │                                   │  BACK ORDER  │
    │  TO MARKET   │                                   │  (pushed)    │
    └──────┬───────┘                                   └──────────────┘
           │
           │ Ship
           ▼
    ┌──────────────┐
    │  SHIPPED TO  │
    │    MARKET    │
    └──────┬───────┘
           │
           │ Mark Arrived
           ▼
    ┌──────────────┐
    │  ARRIVED TO  │
    │    MARKET    │
    └──────────────┘
```

---

## Key Business Rules

1. **Forecasts are auto-generated** - Azure Function creates initial order items
2. **Labels are mandatory** - Cannot confirm without selecting a label
3. **Regulatory must approve labels** - Each order item needs label approval
4. **PO approval requires all items approved** - Cannot request CFO approval until all order items in PO have Regulatory Approved status
5. **Confirm to UP triggers Back Order** - All items become Back Order when PO is confirmed to manufacturer
6. **Partial allocation creates splits** - Remaining quantity can be pushed or deleted
7. **Pushed items stay linked** - Remaining Back Orders stay linked to original PO
8. **Shipping can be partial** - Not all allocated items must ship together

---

*Document generated from Dataverse Solution: SupplyChainSSR v1.1.0.3*
